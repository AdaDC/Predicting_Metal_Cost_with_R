source('~/Desktop/computational-project-cookie-cutter/src/04_model_evaluation.R', echo=TRUE)
load("bin/models.RData")
copper_melt <- melt(all_results_copper, id = "date")
################################
#  Model Evaluation            #
#  AUTHOR: Adamma Morrison     #
#  Nov 10, 2018                #
################################
# This script will generate predictions and compare models
# First load models
load("bin/models.RData")
require(tidyverse)
require(forecast)
require(randomForest)
require(ggplot2)
require(reshape2) # for melt function
require(lubridate) # for highlighting dates on graphs
# Get predictions for the 4 types of models.
simple_LR_copper_pred <- predict(simple_LR_copper, test)
simple_LR_zinc_pred <- predict(simple_LR_zinc, test)
ARIMA_copper_pred <- as.numeric(forecast_copper$mean)
ARIMA_zinc_pred <- as.numeric(forecast_zinc$mean)
NN_copper_pred <- data.frame(nn_forecast_copper)
NN_zinc_pred <- data.frame(nn_forecast_zinc)
RF_copper_pred <-predict(RF_copper, newdata = test)
RF_zinc_pred <-predict(RF_zinc, newdata = test)
## Let's compare each models' predictions - only for LR and RF
# Model Results Graph
all_results_copper <- data.frame(predict(simple_LR_copper, data), predict(RF_copper, data), data[2], data[1])
all_results_zinc <- data.frame(predict(simple_LR_zinc, data), predict(RF_zinc, data), data[3], data[1])
copper_melt <- melt(all_results_copper, id = "date")
require(ggthemes) # for plot themes
ggplot() +
geom_line(data=copper_melt, aes(x=date, y=value, col=variable)) +
ggtitle("Predictions for Copper") +
scale_color_discrete(name  ="Models",
breaks=c("predict.simple_LR_copper..data.", "predict.RF_copper..data.", "copper_price"),
labels=c("Linear Regression", "Random Forest", "Actual Price")) +
geom_rect(data=data.frame(xmin=(as.Date(c("2010-01-01"))),
xmax=(as.Date(c("2018-01-01"))),
ymin=-Inf,
ymax=Inf),
aes(xmin=xmin,xmax=xmax,ymin=ymin,ymax=ymax),
fill="orange",alpha=0.3) +
xlab("Year") +
ylab("Price in USD") +
theme_void()
ggplot() +
geom_line(data=copper_melt, aes(x=date, y=value, col=variable)) +
ggtitle("Predictions for Copper") +
scale_color_discrete(name  ="Models",
breaks=c("predict.simple_LR_copper..data.", "predict.RF_copper..data.", "copper_price"),
labels=c("Linear Regression", "Random Forest", "Actual Price")) +
geom_rect(data=data.frame(xmin=(as.Date(c("2010-01-01"))),
xmax=(as.Date(c("2018-01-01"))),
ymin=-Inf,
ymax=Inf),
aes(xmin=xmin,xmax=xmax,ymin=ymin,ymax=ymax),
fill="orange",alpha=0.3) +
xlab("Year") +
ylab("Price in USD") +
theme_economist()
ggplot() +
geom_line(data=copper_melt, aes(x=date, y=value, col=variable)) +
ggtitle("Predictions for Copper") +
scale_color_discrete(name  ="Models",
breaks=c("predict.simple_LR_copper..data.", "predict.RF_copper..data.", "copper_price"),
labels=c("Linear Regression", "Random Forest", "Actual Price")) +
geom_rect(data=data.frame(xmin=(as.Date(c("2010-01-01"))),
xmax=(as.Date(c("2018-01-01"))),
ymin=-Inf,
ymax=Inf),
aes(xmin=xmin,xmax=xmax,ymin=ymin,ymax=ymax),
fill="orange",alpha=0.3) +
xlab("Year") +
ylab("Price in USD")
ggplot() +
geom_line(data=copper_melt, aes(x=date, y=value, col=variable)) +
ggtitle("Predictions for Copper") +
scale_color_discrete(name  ="Models",
breaks=c("predict.simple_LR_copper..data.", "predict.RF_copper..data.", "copper_price"),
labels=c("Linear Regression", "Random Forest", "Actual Price")) +
geom_rect(data=data.frame(xmin=(as.Date(c("2010-01-01"))),
xmax=(as.Date(c("2018-01-01"))),
ymin=-Inf,
ymax=Inf),
aes(xmin=xmin,xmax=xmax,ymin=ymin,ymax=ymax),
fill="orange",alpha=0.3) +
xlab("Year") +
ylab("Price in USD") +
theme_economist()
ggplot() +
geom_line(data=copper_melt, aes(x=date, y=value, col=variable)) +
ggtitle("Predictions for Copper") +
scale_color_discrete(name  ="Models",
breaks=c("predict.simple_LR_copper..data.", "predict.RF_copper..data.", "copper_price"),
labels=c("Linear Regression", "Random Forest", "Actual Price")) +
geom_rect(data=data.frame(xmin=(as.Date(c("2010-01-01"))),
xmax=(as.Date(c("2018-01-01"))),
ymin=-Inf,
ymax=Inf),
aes(xmin=xmin,xmax=xmax,ymin=ymin,ymax=ymax),
fill="orange",alpha=0.3) +
xlab("Year") +
ylab("Price in USD") +
theme_tufte()
ggplot() +
geom_line(data=copper_melt, aes(x=date, y=value, col=variable)) +
ggtitle("Predictions for Copper") +
scale_color_discrete(name  ="Models",
breaks=c("predict.simple_LR_copper..data.", "predict.RF_copper..data.", "copper_price"),
labels=c("Linear Regression", "Random Forest", "Actual Price")) +
geom_rect(data=data.frame(xmin=(as.Date(c("2010-01-01"))),
xmax=(as.Date(c("2018-01-01"))),
ymin=-Inf,
ymax=Inf),
aes(xmin=xmin,xmax=xmax,ymin=ymin,ymax=ymax),
fill="orange",alpha=0.3) +
xlab("Year") +
ylab("Price in USD") +
theme_light()
ggplot() +
geom_line(data=copper_melt, aes(x=date, y=value, col=variable)) +
ggtitle("Predictions for Copper") +
scale_color_discrete(name  ="Models",
breaks=c("predict.simple_LR_copper..data.", "predict.RF_copper..data.", "copper_price"),
labels=c("Linear Regression", "Random Forest", "Actual Price")) +
geom_rect(data=data.frame(xmin=(as.Date(c("2010-01-01"))),
xmax=(as.Date(c("2018-01-01"))),
ymin=-Inf,
ymax=Inf),
aes(xmin=xmin,xmax=xmax,ymin=ymin,ymax=ymax),
fill="orange",alpha=0.3) +
xlab("Year") +
ylab("Price in USD")
ggplot() +
geom_line(data=copper_melt, aes(x=date, y=value, col=variable)) +
ggtitle("Predictions for Copper") +
scale_color_discrete(name  ="Models",
breaks=c("predict.simple_LR_copper..data.", "predict.RF_copper..data.", "copper_price"),
labels=c("Linear Regression", "Random Forest", "Actual Price")) +
geom_rect(data=data.frame(xmin=(as.Date(c("2010-01-01"))),
xmax=(as.Date(c("2018-01-01"))),
ymin=-Inf,
ymax=Inf),
aes(xmin=xmin,xmax=xmax,ymin=ymin,ymax=ymax),
fill="orange",alpha=0.3) +
xlab("Year") +
ylab("Price in USD") +
theme_few()
ggplot() +
geom_line(data=copper_melt, aes(x=date, y=value, col=variable)) +
ggtitle("Predictions for Copper") +
scale_color_discrete(name  ="Models",
breaks=c("predict.simple_LR_copper..data.", "predict.RF_copper..data.", "copper_price"),
labels=c("Linear Regression", "Random Forest", "Actual Price")) +
geom_rect(data=data.frame(xmin=(as.Date(c("2010-01-01"))),
xmax=(as.Date(c("2018-01-01"))),
ymin=-Inf,
ymax=Inf),
aes(xmin=xmin,xmax=xmax,ymin=ymin,ymax=ymax),
fill="orange",alpha=0.3) +
xlab("Year") +
ylab("Price in USD") +
theme_stata()
ggplot() +
geom_line(data=copper_melt, aes(x=date, y=value, col=variable)) +
ggtitle("Predictions for Copper") +
scale_color_discrete(name  ="Models",
breaks=c("predict.simple_LR_copper..data.", "predict.RF_copper..data.", "copper_price"),
labels=c("Linear Regression", "Random Forest", "Actual Price")) +
geom_rect(data=data.frame(xmin=(as.Date(c("2010-01-01"))),
xmax=(as.Date(c("2018-01-01"))),
ymin=-Inf,
ymax=Inf),
aes(xmin=xmin,xmax=xmax,ymin=ymin,ymax=ymax),
fill="orange",alpha=0.3) +
xlab("Year") +
ylab("Price in USD") +
theme_stata()
# Plot results
ggplot() +
geom_line(data=copper_melt, aes(x=date, y=value, col=variable)) +
ggtitle("Predictions for Copper") +
scale_color_discrete(name  ="Models",
breaks=c("predict.simple_LR_copper..data.", "predict.RF_copper..data.", "copper_price"),
labels=c("Linear Regression", "Random Forest", "Actual Price")) +
geom_rect(data=data.frame(xmin=(as.Date(c("2010-01-01"))),
xmax=(as.Date(c("2018-01-01"))),
ymin=-Inf,
ymax=Inf),
aes(xmin=xmin,xmax=xmax,ymin=ymin,ymax=ymax),
fill="orange",alpha=0.3) +
xlab("Year") +
ylab("Price in USD") +
theme_stata()
zinc_melt <- melt(all_results_zinc, id = "date")
ggplot() +
geom_line(data=zinc_melt, aes(x=date, y=value, col=variable)) +
ggtitle("Predictions for Zinc") +
scale_color_discrete(name  ="Models",
breaks=c("predict.simple_LR_zinc..data.", "predict.RF_zinc..data.", "zinc_price"),
labels=c("Linear Regression", "Random Forest", "Actual Price")) +
geom_rect(data=data.frame(xmin=(as.Date(c("2010-01-01"))),
xmax=(as.Date(c("2018-01-01"))),
ymin=-Inf,
ymax=Inf),
aes(xmin=xmin,xmax=xmax,ymin=ymin,ymax=ymax),
fill="orange",alpha=0.3) +
xlab("Year") +
ylab("Price in USD") +
theme_stata()
ggplot() +
geom_line(data=copper_melt, aes(x=date, y=value, col=variable)) +
ggtitle("Predictions for Copper") +
scale_color_discrete(name  ="Models",
breaks=c("predict.simple_LR_copper..data.", "predict.RF_copper..data.", "copper_price"),
labels=c("Linear Regression", "Random Forest", "Actual Price")) +
geom_rect(data=data.frame(xmin=(as.Date(c("2010-01-01"))),
xmax=(as.Date(c("2018-01-01"))),
ymin=-Inf,
ymax=Inf),
aes(xmin=xmin,xmax=xmax,ymin=ymin,ymax=ymax),
fill="orange",alpha=0.3) +
xlab("Year") +
scale_x_date(labels = date_format("%m/%d")) +
ylab("Price in USD") +
theme_stata()
require("scales")
ggplot() +
geom_line(data=copper_melt, aes(x=date, y=value, col=variable)) +
ggtitle("Predictions for Copper") +
scale_color_discrete(name  ="Models",
breaks=c("predict.simple_LR_copper..data.", "predict.RF_copper..data.", "copper_price"),
labels=c("Linear Regression", "Random Forest", "Actual Price")) +
geom_rect(data=data.frame(xmin=(as.Date(c("2010-01-01"))),
xmax=(as.Date(c("2018-01-01"))),
ymin=-Inf,
ymax=Inf),
aes(xmin=xmin,xmax=xmax,ymin=ymin,ymax=ymax),
fill="orange",alpha=0.3) +
xlab("Year") +
scale_x_date(labels = date_format("%m/%d")) +
ylab("Price in USD") +
theme_stata()
ggplot() +
geom_line(data=copper_melt, aes(x=date, y=value, col=variable)) +
ggtitle("Predictions for Copper") +
scale_color_discrete(name  ="Models",
breaks=c("predict.simple_LR_copper..data.", "predict.RF_copper..data.", "copper_price"),
labels=c("Linear Regression", "Random Forest", "Actual Price")) +
geom_rect(data=data.frame(xmin=(as.Date(c("2010-01-01"))),
xmax=(as.Date(c("2018-01-01"))),
ymin=-Inf,
ymax=Inf),
aes(xmin=xmin,xmax=xmax,ymin=ymin,ymax=ymax),
fill="orange",alpha=0.3) +
xlab("Year") +
scale_x_date(labels = date_format("%Y")) +
ylab("Price in USD") +
theme_stata()
ggplot() +
geom_line(data=copper_melt, aes(x=date, y=value, col=variable)) +
ggtitle("Predictions for Copper") +
scale_color_discrete(name  ="Models",
breaks=c("predict.simple_LR_copper..data.", "predict.RF_copper..data.", "copper_price"),
labels=c("Linear Regression", "Random Forest", "Actual Price")) +
geom_rect(data=data.frame(xmin=(as.Date(c("2010-01-01"))),
xmax=(as.Date(c("2018-01-01"))),
ymin=-Inf,
ymax=Inf),
aes(xmin=xmin,xmax=xmax,ymin=ymin,ymax=ymax),
fill="orange",alpha=0.3) +
xlab("Year") +
scale_x_date(labels = date_breaks("%Y")) +
ylab("Price in USD") +
theme_stata()
################################
#  Model Evaluation            #
#  AUTHOR: Adamma Morrison     #
#  Nov 10, 2018                #
################################
# This script will generate predictions and compare models
# First load models
load("bin/models.RData")
require(tidyverse)
require(forecast)
require(randomForest)
require(ggplot2)
require(reshape2) # for melt function
require(lubridate) # for highlighting dates on graphs
require(ggthemes) # for plot themes
# Get predictions for the 4 types of models.
simple_LR_copper_pred <- predict(simple_LR_copper, test)
simple_LR_zinc_pred <- predict(simple_LR_zinc, test)
ARIMA_copper_pred <- as.numeric(forecast_copper$mean)
ARIMA_zinc_pred <- as.numeric(forecast_zinc$mean)
NN_copper_pred <- data.frame(nn_forecast_copper)
NN_zinc_pred <- data.frame(nn_forecast_zinc)
RF_copper_pred <-predict(RF_copper, newdata = test)
RF_zinc_pred <-predict(RF_zinc, newdata = test)
## Let's compare each models' predictions
# Model Results Graph
all_results_copper <- data.frame(predict(simple_LR_copper, data), predict(RF_copper, data), data[2], data[1])
all_results_zinc <- data.frame(predict(simple_LR_zinc, data), predict(RF_zinc, data), data[3], data[1])
# Graph for copper
copper_melt <- melt(all_results_copper, id = "date")
ggplot() +
geom_line(data=copper_melt, aes(x=date, y=value, col=variable)) +
ggtitle("Predictions for Copper") +
scale_color_discrete(name  ="Models",
breaks=c("predict.simple_LR_copper..data.", "predict.RF_copper..data.", "copper_price"),
labels=c("Linear Regression", "Random Forest", "Actual Price")) +
geom_rect(data=data.frame(xmin=(as.Date(c("2010-01-01"))),
xmax=(as.Date(c("2018-01-01"))),
ymin=-Inf,
ymax=Inf),
aes(xmin=xmin,xmax=xmax,ymin=ymin,ymax=ymax),
fill="orange",alpha=0.3) +
xlab("Year") +
ylab("Price in USD") +
theme_stata()
# Graph for zinc
zinc_melt <- melt(all_results_zinc, id = "date")
ggplot() +
geom_line(data=zinc_melt, aes(x=date, y=value, col=variable)) +
ggtitle("Predictions for Zinc") +
scale_color_discrete(name  ="Models",
breaks=c("predict.simple_LR_zinc..data.", "predict.RF_zinc..data.", "zinc_price"),
labels=c("Linear Regression", "Random Forest", "Actual Price")) +
geom_rect(data=data.frame(xmin=(as.Date(c("2010-01-01"))),
xmax=(as.Date(c("2018-01-01"))),
ymin=-Inf,
ymax=Inf),
aes(xmin=xmin,xmax=xmax,ymin=ymin,ymax=ymax),
fill="orange",alpha=0.3) +
xlab("Year") +
ylab("Price in USD") +
theme_stata()
# Now let's see forecast models
par(mfrow=c(1,2))
plot(forecast_copper, main ="ARIMA Forecast for Copper")
plot(nn_forecast_copper, main ="NN Forecast for Copper")
par(mfrow=c(1,2))
plot(forecast_zinc, main ="ARIMA Forecast for Zinc")
plot(nn_forecast_zinc, main ="NN Forecast for Zinc")
################################
# This part of the script will output csv files with the results of all models
#write.csv(nn_forecast_zinc, "results/nn_results_zinc.csv", row.names = F)
#write.csv(nn_forecast_copper, "results/nn_results_copper.csv", row.names = F)
#write.csv(all_results_zinc, "results/all_results_zinc.csv", row.names = F)
#write.csv(all_results_copper, "results/all_results_copper.csv", row.names = F)
ggplot() +
geom_line(data=copper_melt, aes(x=date, y=value, col=variable)) +
ggtitle("Predictions for Copper") +
scale_color_discrete(name  ="Models",
breaks=c("predict.simple_LR_copper..data.", "predict.RF_copper..data.", "copper_price"),
labels=c("Linear Regression", "Random Forest", "Actual Price")) +
geom_rect(data=data.frame(xmin=(as.Date(c("2010-01-01"))),
xmax=(as.Date(c("2018-01-01"))),
ymin=-Inf,
ymax=Inf),
aes(xmin=xmin,xmax=xmax,ymin=ymin,ymax=ymax),
fill="orange",alpha=0.3) +
xlab("Year") +
ylab("Price in USD") +
theme_stata()
# Graph for zinc
zinc_melt <- melt(all_results_zinc, id = "date")
ggplot() +
geom_line(data=zinc_melt, aes(x=date, y=value, col=variable)) +
ggtitle("Predictions for Zinc") +
scale_color_discrete(name  ="Models",
breaks=c("predict.simple_LR_zinc..data.", "predict.RF_zinc..data.", "zinc_price"),
labels=c("Linear Regression", "Random Forest", "Actual Price")) +
geom_rect(data=data.frame(xmin=(as.Date(c("2010-01-01"))),
xmax=(as.Date(c("2018-01-01"))),
ymin=-Inf,
ymax=Inf),
aes(xmin=xmin,xmax=xmax,ymin=ymin,ymax=ymax),
fill="orange",alpha=0.3) +
xlab("Year") +
ylab("Price in USD") +
theme_stata()
## Generate time series of all variables
all_vars_melted <- melt(data, id = "date")
qplot(date, value, data = all_vars_melted, geom = "line", group = variable) +
facet_grid(variable ~ ., scale = "free_y") +
theme_bw() +
ggtitle("Time Series of all Variables") +
theme_stata()
ggplot(output_vars_melted, aes(x=date, y=value, col=variable)) + geom_line() +
ggtitle("Historic Prices for Copper and Zinc") +
theme_stata()
################################
#  Exploratory Data Analysis   #
#  AUTHOR: Adamma Morrison     #
#  Nov 10, 2018                #
################################
# Now let's explore the cleaned data with a few graphs
# First load necessary libraries
require(tidyverse)
require(ggplot2)
require(plotly)
require(reshape2) # for melt function
require(ggthemes)
# Then load information
data <- read_csv("data/cleaned_data.csv") # The read_csv command is faster, and it automatically parses most of the data
data[c(2,3,6,7,11,12)] <- lapply(data[c(2,3,6,7,11,12)], as.numeric) # these columns need to be changed to numeric
# See summary for data - min, quartiles, mean, median, and max
summary(data)
# First look at time series graph for two variables of interest; price for copper and zinc
output_vars_melted <- melt(data[1:3], id = "date")
ggplot(output_vars_melted, aes(x=date, y=value, col=variable)) + geom_line() +
ggtitle("Historic Prices for Copper and Zinc") +
theme_stata()
ggplot() +
geom_line(data=copper_melt, aes(x=date, y=value, col=variable)) +
ggtitle("Copper") +
scale_color_discrete(name  ="Models",
breaks=c("predict.simple_LR_copper..data.", "predict.RF_copper..data.", "copper_price"),
labels=c("Linear Regression", "Random Forest", "Actual Price")) +
geom_rect(data=data.frame(xmin=(as.Date(c("2010-01-01"))),
xmax=(as.Date(c("2018-01-01"))),
ymin=-Inf,
ymax=Inf),
aes(xmin=xmin,xmax=xmax,ymin=ymin,ymax=ymax),
fill="orange",alpha=0.3) +
xlab("Year") +
ylab("Price in USD") +
theme_stata()
# Graph for zinc
zinc_melt <- melt(all_results_zinc, id = "date")
ggplot() +
geom_line(data=zinc_melt, aes(x=date, y=value, col=variable)) +
ggtitle("Zinc") +
scale_color_discrete(name  ="Models",
breaks=c("predict.simple_LR_zinc..data.", "predict.RF_zinc..data.", "zinc_price"),
labels=c("Linear Regression", "Random Forest", "Actual Price")) +
geom_rect(data=data.frame(xmin=(as.Date(c("2010-01-01"))),
xmax=(as.Date(c("2018-01-01"))),
ymin=-Inf,
ymax=Inf),
aes(xmin=xmin,xmax=xmax,ymin=ymin,ymax=ymax),
fill="orange",alpha=0.3) +
xlab("Year") +
ylab("Price in USD") +
theme_stata()
